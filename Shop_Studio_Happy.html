<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="Logo/webLOGOpart_icon_w_TRANSBG.png" type="image/x-icon">
    <title>Linkly-BuyCard-Studio-Happy</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['-apple-system', 'BlinkMacSystemFont', '"Segoe UI"', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'] },
                    colors: {
                        'bg-black': '#000000',
                        'card-dark': '#161617',
                        'text-grey': '#86868b',
                        'accent-blue': '#2997ff'
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            /* 基础深色主题 */
            --bg-color: #050505;
            --panel-bg: #111111;
            --text-primary: #ffffff;
            --text-secondary: #999999;
            --accent-blue: #0a84ff;
            --border-color: #333333;
            --input-bg: #1c1c1e;
            --nav-height: 48px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-primary); -webkit-font-smoothing: antialiased; }

        /* 玻璃导航效果 */
        .glass-nav {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* 导航链接样式 */
        .navbar-links a {
            color: white;
            text-decoration: none;
            font-size: 0.875rem;
            transition: font-weight 0.3s ease;
        }

        .navbar-links a:hover {
            font-weight: bold;
            color: #2997ff;
        }

        .navbar-links a.active {
            font-weight: bold;
            color: white; 
        }

        .navbar-btns a {
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .navbar-btns .buy-btn:hover {
            background-color: #2997ff;
            color: white;
            font-weight: bold;
        }

        .navbar-btns .login-btn:hover {
            color: #2997ff;
            font-weight: bold;
        }

        /* 主布局 */
        .main-container {
            max-width: 1080px; margin: 0 auto; padding: calc(var(--nav-height) + 40px) 20px 80px;
            min-height: 100vh;
        }

        .product-configurator {
            display: grid; grid-template-columns: 1.2fr 1fr; gap: 60px; align-items: start;
        }

        /* --- 左侧：预览舞台 --- */
        .preview-stage {
            position: sticky; top: 100px;
            background: var(--panel-bg); border-radius: 24px;
            padding: 60px 40px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border: 1px solid var(--border-color);
            background-image: radial-gradient(circle at 50% 50%, rgba(10, 132, 255, 0.05), transparent 70%);
        }

        .preview-card-container { perspective: 1000px; margin-bottom: 30px; display: flex; flex-direction: column; gap: 40px; align-items: center;}
        
        .interactive-card {
            width: 340px; height: 214px; 
            border-radius: 16px; position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            transform-style: preserve-3d; 
            overflow: hidden; 
            display: block; 
            flex-shrink: 0;
        }

        /* 视觉层 */
        .layer-base, .layer-texture, .layer-pattern-overlay { position: absolute; inset: 0; pointer-events: none; transition: opacity 0.3s; z-index: 0; }

        /* 材质定义 */
        .tex-bamboo { background: #e3cca8; background-image: linear-gradient(90deg, rgba(0,0,0,0.05) 1px, transparent 1px); background-size: 3px 100%; display: none; }
        .tex-clear { 
            background: rgba(255,255,255,0.05); 
            backdrop-filter: blur(12px) saturate(150%);
            -webkit-backdrop-filter: blur(12px) saturate(150%);
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: inset 0 0 20px rgba(255,255,255,0.1);
            display: none; 
        }

        /* 颜色定义 */
        .bg-aurora { background: linear-gradient(135deg, #00c6ff, #0072ff); }
        .bg-sunset { background: linear-gradient(to right, #ff512f, #f09819); }
        .bg-mint { background: #98ff98; color: #005000 !important; }
        .bg-pink { background: #ffb6c1; color: #333 !important; }
        .bg-violet { background: #7F00FF; }
        .bg-yellow { background: #fff700; color: #333 !important; }

        /* 图案定义 */
        .pat-liquid { background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.4), transparent 50%), radial-gradient(circle at 70% 70%, rgba(0,0,0,0.2), transparent 50%); filter: blur(20px); opacity: 0; }
        .pat-cyber { border: 2px solid #0ff; box-shadow: inset 0 0 10px #0ff; opacity: 0; }
        .pat-vapor { background: linear-gradient(0deg, rgba(255,0,255,0.2) 1px, transparent 1px), linear-gradient(90deg, rgba(0,255,255,0.2) 1px, transparent 1px); background-size: 20px 20px; opacity: 0; }
        .pat-pixel { background-image: conic-gradient(rgba(255,255,255,0.2) 90deg, transparent 90deg); background-size: 10px 10px; opacity: 0; }
        .pat-pop { background: radial-gradient(#fff 20%, transparent 20%); background-size: 10px 10px; opacity: 0; }
        .pat-stick { opacity: 0; }

        .show-tex { display: block !important; }
        .show-pat { opacity: 1 !important; }
        .text-dark .card-content { color: #222 !important; text-shadow: none !important; }
        .text-dark .c-avatar { border-color: rgba(0,0,0,0.2) !important; }
        .text-dark .c-brand { opacity: 0.6 !important; }

        /* --- 核心：单一结构布局引擎 --- */
        .card-content { 
            position: relative; z-index: 2; width: 100%; height: 100%; 
            color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.3);
            padding: 20px; box-sizing: border-box;
            display: grid; 
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .c-item { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; min-width: 0; }
        
        .c-avatar {
            background-color: rgba(255,255,255,0.2);
            background-size: cover; background-position: center;
            border: 2px solid rgba(255,255,255,0.8);
            display: flex; align-items: center; justify-content: center;
        }
        .c-avatar::after { content: "IMG"; font-size: 10px; opacity: 0.6; font-weight: bold; }
        .c-avatar.has-img::after { display: none; }

        .c-name { font-weight: 800; line-height: 1.1; font-size: 24px; }
        .c-tag { font-size: 10px; text-transform: uppercase; letter-spacing: 2px; opacity: 0.8; }
        .c-custom { font-size: 11px; opacity: 0.8; font-style: italic; }
        .c-social { font-size: 11px; font-family: monospace; font-weight: 600; }
        .c-mbti { font-size: 10px; font-weight: bold; border: 1px solid currentColor; padding: 2px 5px; border-radius: 4px; width: fit-content; height: fit-content; }
        
        /* 品牌标识样式 */
        .c-brand { 
            position: absolute; font-size: 9px; opacity: 0.4; letter-spacing: 2px; font-weight: 700; text-transform: uppercase; 
            z-index: 5; pointer-events: none;
        }

        /* === 布局定义 === */
        /* Layout 1: 居中堆叠 */
        .layout-1 { grid-template-columns: 1fr; grid-template-rows: auto auto auto auto 1fr auto; justify-items: center; align-content: center; gap: 6px; text-align: center; }
        .layout-1 .c-avatar { width: 64px; height: 64px; border-radius: 50%; margin-bottom: 5px; }
        .layout-1 .c-mbti { position: absolute; top: 20px; right: 20px; }
        .layout-1 .c-social { margin-top: auto; opacity: 0.6; }
        .layout-1 .c-brand { top: 20px; left: 50%; transform: translateX(-50%); }

        /* Layout 2: 左图右文 */
        .layout-2 { grid-template-columns: 100px 1fr; grid-template-rows: auto auto 1fr auto; gap: 0 15px; padding: 0 !important; align-content: center; }
        .layout-2 .c-avatar { grid-row: 1 / -1; width: 100%; height: 100%; border: none; border-right: 1px solid rgba(255,255,255,0.2); border-radius: 0; }
        .layout-2 .c-name { align-self: end; font-size: 26px; }
        .layout-2 .c-tag { align-self: start; margin-bottom: 10px; }
        .layout-2 .c-mbti { position: absolute; top: 15px; right: 15px; }
        .layout-2 .c-social { margin-bottom: 20px; }
        .layout-2 .c-custom { margin-bottom: 5px; }
        .layout-2 .c-brand { bottom: 15px; right: 15px; }

        /* Layout 3: 2x2 网格 (修复版) */
        .layout-3 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; align-items: center; }
        .layout-3 .c-avatar { width: 70px; height: 70px; border-radius: 12px; justify-self: start; align-self: start; }
        .layout-3 .c-mbti { justify-self: end; align-self: start; }
        .layout-3 .c-custom { grid-column: 1 / -1; justify-self: center; font-size: 10px; opacity: 0.6; border-top: 1px solid rgba(255,255,255,0.3); border-bottom: 1px solid rgba(255,255,255,0.3); padding: 5px 20px; width: 100%; text-align: center; }
        .layout-3 .c-name { justify-self: start; align-self: end; font-size: 20px; }
        /* 修复：强制显示 Tag 并调整位置 */
        .layout-3 .c-tag { display: block !important; grid-column: 1 / 2; grid-row: 2 / 3; align-self: end; justify-self: start; margin-bottom: 28px; font-size: 10px; opacity: 0.8; }
        /* .layout-3 .c-social { justify-self: end; align-self: end; } */
        /* 找到这行代码并替换 */
        .layout-3 .c-social { 
            justify-self: end; 
            align-self: end; 
            transform: translateY(10px); /* 正数表示向下移动，10px 可以根据需要调整 */
        }
        .layout-3 .c-brand { top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0.2; }

        /* Layout 4: 大标题风格 */
        .layout-4 { grid-template-columns: auto 1fr; grid-template-rows: 1fr auto auto; gap: 5px 15px; }
        .layout-4 .c-avatar { width: 50px; height: 50px; border-radius: 8px; position: absolute; top: 20px; right: 20px; }
        .layout-4 .c-mbti { position: absolute; top: 20px; left: 20px; border: none; background: rgba(255,255,255,0.2); }
        .layout-4 .c-name { grid-column: 1 / -1; align-self: end; font-size: 32px; letter-spacing: -1px; }
        .layout-4 .c-tag { grid-column: 1 / -1; }
        .layout-4 .c-custom { grid-column: 1 / -1; border-left: 2px solid currentColor; padding-left: 8px; margin-top: 10px; font-size: 10px; }
        .layout-4 .c-social { position: absolute; bottom: 20px; right: 20px; }
        .layout-4 .c-brand { bottom: 22px; right: 50%; transform: translateX(50%); }

        /* Layout 5: 对角线风格 */
        .layout-5 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 10px; }
        .layout-5 .c-avatar { width: 100%; height: 100%; border-radius: 8px; grid-row: 1 / 2; grid-column: 1 / 2; }
        .layout-5 .c-name { grid-column: 2 / 3; align-self: end; text-align: right; font-size: 22px; }
        .layout-5 .c-tag { grid-column: 2 / 3; align-self: start; text-align: right; grid-row: 1 / 2; padding-top: 5px;} 
        .layout-5 .c-custom { grid-column: 1 / 2; grid-row: 2 / 3; align-self: end; font-size: 10px; opacity: 0.7; }
        .layout-5 .c-social { grid-column: 2 / 3; grid-row: 2 / 3; align-self: end; justify-self: end; background: rgba(255,255,255,0.1); padding: 4px 8px; border-radius: 4px; }
        .layout-5 .c-mbti { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #000; color: #fff; z-index: 5; border: 1px solid #333; }
        .layout-5 .c-brand { top: 10px; left: 10px; }


        /* --- 背面样式 (新增) --- */
        .card-back-content {
            position: relative; width: 100%; height: 100%;
        }
        .back-logo {
            position: absolute;
            max-width: 120px; max-height: 60px;
            object-fit: contain;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
        }
        .pos-tl { top: 24px; left: 24px; transform: none; bottom: auto; right: auto; }
        .pos-tr { top: 24px; right: 24px; transform: none; bottom: auto; left: auto; }
        .pos-center { top: 50%; left: 50%; transform: translate(-50%, -50%); bottom: auto; right: auto; }
        .pos-bl { bottom: 24px; left: 24px; transform: none; top: auto; right: auto; }
        .pos-br { bottom: 24px; right: 24px; transform: none; top: auto; left: auto; }


        /* --- UI 组件 --- */
        .preview-note { font-size: 12px; color: var(--text-secondary); margin-top: 15px; text-align: center; }
        .config-panel { padding-top: 0; }
        
        .panel-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid var(--border-color); }
        .mode-badge {
            display: inline-block; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; 
            text-transform: uppercase; letter-spacing: 0.05em;
            background: rgba(10, 132, 255, 0.15); color: var(--accent-blue); border: 1px solid rgba(10, 132, 255, 0.3);
        }
        .top-price-box { text-align: right; }
        .unit-price { font-size: 24px; font-weight: 600; display: block; color: #fff; }
        .unit-label { font-size: 13px; color: var(--text-secondary); display: block; margin-top: 4px; }

        .config-section { margin-top: 24px; padding-bottom: 24px; border-bottom: 1px solid var(--border-color); position: relative; transition: opacity 0.3s; }
        .config-section.disabled { opacity: 0.2; pointer-events: none; filter: grayscale(1); } 
        .config-section:last-child { border-bottom: none; }

        /* 定制分组标题 (新增) */
        .config-group-header {
            font-size: 14px; color: #86868b; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;
            margin: 40px 0 20px 0; border-bottom: 1px solid #333; padding-bottom: 10px;
        }
        
        .config-label-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .config-label { font-size: 14px; font-weight: 600; margin-bottom: 12px; display: block; color: #e5e5e5; }
        .selection-name { color: var(--text-secondary); font-weight: 400; margin-left: 6px; }

        .option-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .grid-3-col { grid-template-columns: repeat(3, 1fr); }
        .option-btn {
            padding: 12px; border: 1px solid var(--border-color); border-radius: 10px;
            background: var(--input-bg); color: #fff; font-size: 12px; cursor: pointer; transition: all 0.2s; text-align: center;
        }
        .option-btn:hover { border-color: #666; }
        .option-btn.active { border-color: var(--accent-blue); color: var(--accent-blue); background: rgba(10, 132, 255, 0.1); }
        .option-btn.disabled { opacity: 0.3; pointer-events: none; border-color: #333; background: #111; color: #666; }

        .color-grid { display: flex; gap: 10px; flex-wrap: wrap; }
        .color-btn {
            width: 36px; height: 36px; border-radius: 50%; border: none; cursor: pointer; transition: transform 0.2s; position: relative; box-shadow: inset 0 0 4px rgba(0,0,0,0.3);
        }
        .color-btn.active { box-shadow: 0 0 0 2px #000, 0 0 0 4px var(--accent-blue); transform: scale(1.1); }

        .layout-selector { display: flex; gap: 10px; }
        .layout-btn {
            width: 44px; height: 44px; border-radius: 8px; border: 1px solid var(--border-color);
            background: var(--input-bg); cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 14px; color: #666; font-weight: bold;
        }
        .layout-btn.active { border-color: var(--accent-blue); background: rgba(10, 132, 255, 0.1); color: var(--accent-blue); }

        .input-group { display: grid; gap: 12px; }
        .input-field {
            width: 100%; padding: 10px 15px; border-radius: 8px; border: 1px solid var(--border-color);
            background: var(--input-bg); color: #fff; font-size: 13px; outline: none;
        }
        .input-field:focus { border-color: var(--accent-blue); }
        .upload-btn {
            display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; padding: 12px; border: 1px dashed var(--border-color); border-radius: 8px;
            background: rgba(255,255,255,0.05); color: #ccc; font-size: 13px; cursor: pointer; transition: 0.2s;
        }
        .upload-btn:hover { border-color: var(--accent-blue); color: #fff; }

        /* 数量选择模块 */
        .qty-wrapper { display: flex; flex-direction: column; gap: 16px; }
        .qty-control-box {
            display: flex; align-items: center; justify-content: space-between;
            background: var(--input-bg); border: 1px solid var(--border-color); border-radius: 12px;
            padding: 4px; transition: border-color 0.2s;
        }
        .qty-control-box:focus-within { border-color: var(--accent-blue); box-shadow: 0 0 0 1px var(--accent-blue); }
        .qty-btn-adjust {
            width: 48px; height: 48px; display: flex; align-items: center; justify-content: center;
            border: none; background: transparent; cursor: pointer; color: var(--accent-blue);
            font-size: 24px; font-weight: 300; border-radius: 8px; transition: background 0.2s;
            user-select: none;
        }
        .qty-btn-adjust:hover { background: rgba(255,255,255,0.1); }
        #custom-qty-input {
            flex: 1; border: none; outline: none; text-align: center;
            font-size: 20px; font-weight: 600; color: #fff;
            -moz-appearance: textfield; background: transparent;
        }
        #custom-qty-input::-webkit-inner-spin-button, #custom-qty-input::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .tier-legend { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .tier-item {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 10px 0; border-radius: 8px; background: rgba(255,255,255,0.05);
            border: 1px solid transparent; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            opacity: 0.6; cursor: pointer;
        }
        .tier-item:hover { opacity: 0.9; background: rgba(255,255,255,0.1); }
        .tier-item.active {
            background: rgba(10, 132, 255, 0.15); border-color: var(--accent-blue);
            opacity: 1; transform: scale(1.02); z-index: 1;
        }
        .t-range { font-size: 11px; color: #888; margin-bottom: 2px; }
        .t-price { font-size: 14px; font-weight: 600; color: #fff; }
        .tier-item.active .t-price { color: var(--accent-blue); }

        /* SaaS & 开关样式 */
        .billing-toggle {
            background: #2c2c2e; padding: 3px; border-radius: 8px; display: inline-flex;
        }
        .bill-opt {
            padding: 6px 12px; font-size: 12px; font-weight: 500; cursor: pointer; border-radius: 6px; 
            color: #888; transition: all 0.2s;
        }
        .bill-opt.active { background: #555; color: #fff; }

        .saas-container { display: flex; flex-direction: column; gap: 12px; }
        .saas-group-title { font-size: 11px; font-weight: 600; text-transform: uppercase; color: #666; margin-top: 16px; margin-bottom: 6px; padding-left: 4px; }
        .saas-group-title:first-child { margin-top: 0; }

        .saas-card {
            border: 1px solid var(--border-color); border-radius: 12px; padding: 18px; background: var(--input-bg);
            cursor: pointer; display: flex; justify-content: space-between; align-items: center;
            transition: all 0.2s;
        }
        .saas-card:hover { border-color: #666; background: #252528; }
        .saas-card.active { border-color: var(--accent-blue); box-shadow: 0 0 0 1px var(--accent-blue); background: rgba(10, 132, 255, 0.15); }
        
        .saas-name { font-weight: 600; font-size: 14px; display: flex; align-items: center; gap: 8px; color: #fff; }
        .saas-feat { font-size: 12px; color: #888; margin-top: 4px; }
        .s-price { font-size: 14px; font-weight: 500; color: #fff; display: block; text-align: right;}
        .s-save { font-size: 11px; color: #0a84ff; font-weight: 600; display: block; margin-top: 2px; text-align: right;}
        .rec-tag { font-size: 10px; background: var(--accent-blue); color: #fff; padding: 2px 6px; border-radius: 4px; vertical-align: middle; }

        /* 底部 */
        .action-area { background: var(--panel-bg); border-radius: 18px; padding: 24px; margin-top: 20px; border: 1px solid var(--border-color); }
        .total-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; font-weight: 600; font-size: 16px; }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .btn { padding: 16px; border-radius: 12px; font-size: 16px; font-weight: 600; text-align: center; cursor: pointer; border: none; width: 100%; transition: all 0.2s; }
        .btn-primary { background: #fff; color: #000; } .btn-primary:hover { background: #e5e5e5; }
        .btn-secondary { background: #333; color: #fff; } .btn-secondary:hover { background: #444; }

    </style>
</head>
<body>

    <nav class="fixed top-0 w-full z-50 glass-nav transition-all duration-300">
        <div class="max-w-[980px] mx-auto px-6 h-12 flex items-center justify-between">
            <!-- <a href="index.html" class="text-lg font-semibold text-white hover:text-gray-300 transition-colors">
                Linkly
            </a> -->
            <div class="nav-content">
                <a href="index.html" class="nav-link" style="display: flex; align-items: center;">
                    <img src="Logo/darkBGver.png" alt="Linkly Logo" style="max-height: 28px; width: auto;">
                </a>
                <div style="display:flex; gap:24px;">
                    </div>
            </div>
            <div class="hidden md:flex items-center gap-8 navbar-links">
                <div class="relative group h-full flex items-center">
                    <a href="Product.html" class="text-[#1d1d1f] text-[0.875rem] hover:text-[#0071e3] transition-colors py-4">
                        产品
                    </a>
                    <div class="absolute top-[80%] left-1/2 -translate-x-1/2 pt-6 opacity-0 invisible group-hover:opacity-100 group-hover:visible group-hover:top-[60%] transition-all duration-300 ease-out z-50">
                        <div class="bg-[#161617]/90 backdrop-blur-xl border border-black/5 rounded-xl shadow-xl p-2 min-w-[140px] flex flex-col gap-1 overflow-hidden">
                            <a href="Product.html" class="block px-4 py-2.5 text-[13px] text-[#1d1d1f] hover:bg-[#f5f5f7] hover:text-[#0071e3] rounded-lg transition-colors text-center whitespace-nowrap">
                                Linkly 名片
                            </a>
                            <a href="Linkly_AI_Intro.html" class="block px-4 py-2.5 text-[13px] text-[#1d1d1f] hover:bg-[#f5f5f7] hover:text-[#0071e3] rounded-lg transition-colors text-center whitespace-nowrap">
                                Linkly AI
                            </a>
                            <a href="Enterprise_Intro.html" class="block px-4 py-2.5 text-[13px] text-[#1d1d1f] hover:bg-[#f5f5f7] hover:text-[#0071e3] rounded-lg transition-colors text-center whitespace-nowrap">
                                Linkly 企业版
                            </a>
                        </div>
                    </div>
                </div>
                <a href="AI_Detailed_2.html">Linkly AI</a> 
                <a href="B_Detailed_2black_WordPolish.html">Linkly 企业版</a> 
                <div class="relative group h-full flex items-center">
                    <span class="cursor-pointer py-4 text-[0.875rem] text-white group-hover:text-[#2997ff] group-hover:font-bold transition-all duration-300">
                        定价
                    </span>
                    <div class="absolute left-1/2 -translate-x-1/2 top-[3rem] pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform translate-y-2 group-hover:translate-y-0">
                        <div class="bg-[#161617]/90 backdrop-blur-xl border border-white/10 rounded-xl overflow-hidden shadow-2xl w-32 flex flex-col p-1">
                            <a href="VIP_Compare_2.html" class="block w-full px-4 py-2.5 text-center text-[13px] text-[#e8e8ed] hover:bg-white/10 rounded-lg hover:text-white transition-colors !font-normal">
                                软件应用
                            </a>
                            <a href="Price_Card.html" class="block w-full px-4 py-2.5 text-center text-[13px] text-[#e8e8ed] hover:bg-white/10 rounded-lg hover:text-white transition-colors !font-normal">
                                实体名片
                            </a>
                        </div>
                    </div>
                </div>
                <div class="relative group h-full flex items-center">
                    <a href="Download.html" class="text-[#1d1d1f] text-[0.875rem] hover:text-[#0071e3] transition-colors py-4">
                        支持
                    </a>
                    <div class="absolute top-[80%] left-1/2 -translate-x-1/2 pt-6 opacity-0 invisible group-hover:opacity-100 group-hover:visible group-hover:top-[60%] transition-all duration-300 ease-out z-50">
                        <div class="bg-[#161617]/90 backdrop-blur-xl border border-black/5 rounded-xl shadow-xl p-2 min-w-[140px] flex flex-col gap-1 overflow-hidden">
                            <a href="Download.html" class="block px-4 py-2.5 text-[13px] text-[#1d1d1f] hover:bg-[#f5f5f7] hover:text-[#0071e3] rounded-lg transition-colors text-center whitespace-nowrap">
                                应用下载
                            </a>
                            <a href="User_Guide.html" class="block px-4 py-2.5 text-[13px] text-[#1d1d1f] hover:bg-[#f5f5f7] hover:text-[#0071e3] rounded-lg transition-colors text-center whitespace-nowrap">
                                使用说明
                            </a>
                            <a href="Tech_Spec.html" class="block px-4 py-2.5 text-[13px] text-[#1d1d1f] hover:bg-[#f5f5f7] hover:text-[#0071e3] rounded-lg transition-colors text-center whitespace-nowrap">
                                技术详情
                            </a>
                            <a href="QA.html" class="block px-4 py-2.5 text-[13px] text-[#1d1d1f] hover:bg-[#f5f5f7] hover:text-[#0071e3] rounded-lg transition-colors text-center whitespace-nowrap">
                                常见问题
                            </a>
                            <a href="Contact_Us.html" class="block px-4 py-2.5 text-[13px] text-[#1d1d1f] hover:bg-[#f5f5f7] hover:text-[#0071e3] rounded-lg transition-colors text-center whitespace-nowrap">
                                联系我们
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex items-center gap-4 text-[0.875rem]">
                <a href="#" class="text-[#e8e8ed] hover:text-white transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"/>
                    </svg>
                </a>
                <a href="ShopBag.html" class="text-[#e8e8ed] hover:text-blue-400 transition-colors relative group">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                    </svg>
                </a>
                <a href="Shop_General.html" class="bg-white text-black px-3 py-1 rounded-full font-medium hover:bg-[#2997ff] hover:text-white hover:font-bold transition-all duration-300 buy-btn">购买</a>
                <a href="#" class="hidden md:block text-[#e8e8ed] hover:text-[#2997ff] hover:font-bold transition-all duration-300 login-btn">登录</a>
            </div>
        </div>
    </nav>

<div class="main-container">
    <div class="product-configurator">
        
        <div class="preview-stage">
            <div class="preview-card-container">
                <div id="dynamic-card" class="interactive-card bg-aurora layout-1">
                    <div id="tex-layer" class="layer-texture"></div>
                    <div id="pat-layer" class="layer-pattern-overlay"></div>
                    
                    <div class="card-content">
                        <div class="c-brand" id="prev-brand">LINKLY</div>
                        <div class="c-avatar" id="prev-avatar"></div>
                        <div class="c-name c-item" id="prev-name">Alex.W</div>
                        <div class="c-tag c-item" id="prev-tag">DIGITAL CREATOR</div>
                        <div class="c-custom c-item" id="prev-custom">Making magic happen ✨</div>
                        <div class="c-mbti c-item" id="prev-mbti">ENFP</div>
                        <div class="c-social c-item" id="prev-social">@alex_creative</div>
                    </div>
                </div>
                <p class="preview-note" style="margin-top: 5px;">正面预览</p>
                
                <div id="dynamic-card-back" class="interactive-card bg-aurora" style="transform: none;">
                    <div id="tex-layer-back" class="layer-texture"></div>
                    <div id="pat-layer-back" class="layer-pattern-overlay"></div>
                    <div class="card-back-content">
                        <img id="prev-back-logo" src="Logo/webLOGOpart_icon_w_TRANSBG.png" class="back-logo pos-center" alt="Logo" style="opacity: 0.3;">
                    </div>
                </div>
                <p class="preview-note" style="margin-top: 5px;">背面预览</p>
            </div>
        </div>

        <div class="config-panel">
            
            <div class="panel-header">
                <div>
                    <div class="mode-badge">Social Mode</div>
                </div>
                <div class="top-price-box">
                    <span class="unit-price" id="unit-price-display">$34.90</span>
                    <span class="unit-label">实体卡单价</span>
                </div>
            </div>

            <div class="config-section">
                <span class="config-label">材质 <span id="lbl-mat" class="selection-name">标准 PVC</span></span>
                <div class="option-group" id="group-mat">
                    <div class="option-btn active" data-type="pvc" data-name="标准 PVC">标准 PVC</div>
                    <div class="option-btn" data-type="pvc-matte" data-name="哑光磨砂 PVC">哑光磨砂 PVC</div>
                    <div class="option-btn" data-type="bamboo" data-name="楠竹 (环保)">楠竹 (环保)</div>
                    <div class="option-btn" data-type="clear" data-name="透明 PET">透明 PET</div>
                </div>
            </div>

            <div class="config-section" id="sec-color">
                <span class="config-label">底色 <span id="lbl-color" class="selection-name">极光渐变</span></span>
                <div class="color-grid" id="group-color">
                    <div class="color-btn active" data-color="bg-aurora" data-name="极光渐变" style="background:linear-gradient(135deg, #00c6ff, #0072ff);"></div>
                    <div class="color-btn" data-color="bg-sunset" data-name="落日橙" style="background:linear-gradient(to right, #ff512f, #f09819);"></div>
                    <div class="color-btn" data-color="bg-mint" data-name="薄荷绿" style="background:#98ff98;"></div>
                    <div class="color-btn" data-color="bg-pink" data-name="千禧粉" style="background:#ffb6c1;"></div>
                    <div class="color-btn" data-color="bg-violet" data-name="电光紫" style="background:#7F00FF;"></div>
                    <div class="color-btn" data-color="bg-yellow" data-name="柠檬黄" style="background:#fff700;"></div>
                </div>
            </div>

            <div class="config-section" id="sec-pattern">
                <span class="config-label">图案 <span id="lbl-pat" class="selection-name">纯色</span></span>
                <div class="option-group grid-3-col" id="group-pat">
                    <div class="option-btn active" data-pat="none" data-name="纯色">纯色</div>
                    <div class="option-btn" data-pat="pat-liquid" data-name="液态渐变">液态渐变</div>
                    <div class="option-btn" data-pat="pat-cyber" data-name="赛博朋克">赛博朋克</div>
                    <div class="option-btn" data-pat="pat-vapor" data-name="蒸汽波">蒸汽波</div>
                    <div class="option-btn" data-pat="pat-pop" data-name="波普风格">波普风格</div>
                    <div class="option-btn" data-pat="pat-pixel" data-name="像素风">像素风</div>
                </div>
            </div>

            <div class="config-group-header">卡片正面定制</div>

            <div class="config-section">
                <span class="config-label">版式布局 (含头像)</span>
                <div class="layout-selector" id="group-layout">
                    <div class="layout-btn active" data-layout="layout-1">1</div>
                    <div class="layout-btn" data-layout="layout-2">2</div>
                    <div class="layout-btn" data-layout="layout-3">3</div>
                    <div class="layout-btn" data-layout="layout-4">4</div>
                    <div class="layout-btn" data-layout="layout-5">5</div>
                </div>

                <div style="margin-top: 20px; display: flex; align-items: center; justify-content: space-between;">
                    <span class="config-label" style="font-size: 15px; margin: 0;">保留 Linkly 品牌标识</span>
                    <div class="billing-toggle">
                        <div class="bill-opt active" id="brand-on" onclick="toggleBranding(true)">保留</div>
                        <div class="bill-opt" id="brand-off" onclick="toggleBranding(false)">隐藏</div>
                    </div>
                </div>
            </div>

            <div class="config-section">
                <span class="config-label">个性化信息</span>
                <div class="input-group">
                    <label class="upload-btn">
                        <input type="file" id="file-input" accept="image/*" style="display:none;" onchange="handleUpload(this)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                        上传头像 (支持 JPG/PNG)
                    </label>

                    <input type="text" class="input-field" placeholder="昵称: Alex.W" oninput="updateTxt('prev-name', this.value)">
                    <input type="text" class="input-field" placeholder="身份: DIGITAL CREATOR" oninput="updateTxt('prev-tag', this.value)">
                    <input type="text" class="input-field" placeholder="MBTI/星座: ENFP" oninput="updateTxt('prev-mbti', this.value)">
                    <input type="text" class="input-field" placeholder="社交ID: @alex_creative" oninput="updateTxt('prev-social', this.value)">
                    <input type="text" class="input-field" placeholder="自定义文本: Making magic happen ✨" oninput="updateTxt('prev-custom', this.value)">
                </div>
            </div>

            <div class="config-group-header">卡片背面定制</div>

            <div class="config-section">
                <span class="config-label">背面 Logo 位置</span>
                <div class="layout-selector" id="group-back-pos">
                    <div class="layout-btn" data-pos="pos-tl" title="左上">↖</div>
                    <div class="layout-btn" data-pos="pos-tr" title="右上">↗</div>
                    <div class="layout-btn active" data-pos="pos-center" title="居中">●</div>
                    <div class="layout-btn" data-pos="pos-bl" title="左下">↙</div>
                    <div class="layout-btn" data-pos="pos-br" title="右下">↘</div>
                </div>
            </div>

            <div class="config-section">
                <span class="config-label">上传背面 Logo</span>
                <div class="input-group">
                    <label class="upload-btn">
                        <input type="file" id="logo-input" accept="image/*" style="display:none;" onchange="handleLogoUpload(this)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                        上传 Logo (PNG透明底最佳)
                    </label>
                </div>
            </div>
            
            <div class="config-group-header" style="border:none;"></div> 

            <div class="config-section">
                <span class="config-label">订量 <span class="selection-name">输入具体数量</span></span>
                
                <div class="qty-wrapper">
                    <div class="qty-control-box">
                        <button class="qty-btn-adjust" onclick="adjustQty(-1)">−</button>
                        <input type="number" id="custom-qty-input" value="1" min="1" max="50000" oninput="handleQtyInput(this.value)">
                        <button class="qty-btn-adjust" onclick="adjustQty(1)">+</button>
                    </div>

                    <div class="tier-legend">
                        <div class="tier-item active" id="tier-1" onclick="selectTier(1)">
                            <span class="t-range">1-99</span>
                            <span class="t-price" id="p-tier-1">$--</span>
                        </div>
                        <div class="tier-item" id="tier-100" onclick="selectTier(100)">
                            <span class="t-range">100-999</span>
                            <span class="t-price" id="p-tier-100">$--</span>
                        </div>
                        <div class="tier-item" id="tier-1000" onclick="selectTier(1000)">
                            <span class="t-range">1k-9999</span>
                            <span class="t-price" id="p-tier-1000">$--</span>
                        </div>
                        <div class="tier-item" id="tier-10000" onclick="selectTier(10000)">
                            <span class="t-range">10k+</span>
                            <span class="t-price" id="p-tier-10000">$--</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="config-section">
                <span class="config-label">赠送会员体验 <span class="selection-name" id="lbl-saas-gift">Ultra AI 6个月</span></span>
                <div class="option-group grid-3-col" id="group-saas-gift">
                    <div class="option-btn active" id="btn-gift-pvc" data-gift="ultra-6m">Ultra AI 6个月</div>
                    <div class="option-btn disabled" id="btn-gift-nonpvc-1" data-gift="ultra-1y">Ultra AI 1年</div>
                    <div class="option-btn disabled" id="btn-gift-nonpvc-2" data-gift="team-6m">Team 6个月</div>
                </div>
                 <p style="margin-top:10px; font-size:12px; color:#666;">* 随实体卡赠送，收货激活后立即生效。</p>
            </div>

            <div class="config-section">
                <div class="config-label-row">
                    <span class="config-label">Linkly Ultra 智能服务 <span class="selection-name">可选</span></span>
                    <div class="billing-toggle">
                        <div class="bill-opt active" id="btn-yearly" onclick="toggleBilling('yearly')">按年 (省20%)</div>
                        <div class="bill-opt" id="btn-monthly" onclick="toggleBilling('monthly')">按月</div>
                    </div>
                </div>

                <div class="saas-container">
                    <div class="saas-group-title">个人版</div>
                    <div class="saas-card active" onclick="selectSaas('free', this)">
                        <div class="saas-info">
                            <div class="saas-name">Free 免费版</div>
                            <div class="saas-feat">基础功能，无广告。</div>
                        </div>
                        <div class="saas-price-box"><span class="s-price">免费</span></div>
                    </div>
                    <div class="saas-card" onclick="selectSaas('pro', this)">
                        <div class="saas-info">
                            <div class="saas-name">Pro 专业版 <span class="rec-tag">推荐</span></div>
                            <div class="saas-feat">多身份管理，高级数据统计。</div>
                        </div>
                        <div class="saas-price-box">
                            <span class="s-price" id="price-pro">$49.00/年</span>
                            <span class="s-save" id="save-pro">省 17%</span>
                        </div>
                    </div>
                    <div class="saas-card" onclick="selectSaas('ultra', this)">
                        <div class="saas-info">
                            <div class="saas-name">Ultra 终极版</div>
                            <div class="saas-feat">AI 全局助手，无限文件库。</div>
                        </div>
                        <div class="saas-price-box">
                            <span class="s-price" id="price-ultra">$119.00/年</span>
                            <span class="s-save" id="save-ultra">省 33%</span>
                        </div>
                    </div>

                    <div class="saas-group-title">团队与企业</div>
                    <div class="saas-card" onclick="selectSaas('team', this)">
                        <div class="saas-info">
                            <div class="saas-name">Team 团队版</div>
                            <div class="saas-feat">统一管理后台，员工权限控制。</div>
                        </div>
                        <div class="saas-price-box">
                            <span class="s-price" id="price-team">$129.00/人/年</span>
                            <span class="s-save" id="save-team">省 17%</span>
                        </div>
                    </div>
                    <div class="saas-card" onclick="selectSaas('enterprise', this)">
                        <div class="saas-info">
                            <div class="saas-name">Enterprise 企业定制</div>
                            <div class="saas-feat">API 对接，私有化部署。</div>
                        </div>
                        <div class="saas-price-box"><span class="s-price">联系销售</span></div>
                    </div>
                </div>
            </div>

            <div class="action-area">
                <div class="total-row">
                    <span>预计总价 (含会员)</span>
                    <span id="final-price">--</span>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary">立即结账</button>
                    <button class="btn btn-secondary">添加到购物袋</button>
                </div>
            </div>

        </div>
    </div>
</div>


    <footer style="background-color: #000000; color: #86868b; font-size: 12px; line-height: 1.33337; font-weight: 400; padding: 0 20px; border-top: 1px solid #333; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;">
        <div style="max-width: 980px; margin: 0 auto; padding: 40px 0 20px;">
            <div style="border-bottom: 1px solid #333; padding-bottom: 20px; margin-bottom: 20px;">
                更多选购方式：<a href="Shop_General.html" style="color: #2997ff; text-decoration: none;">前往 Linkly 商店</a>，或发送邮件至 <a href="mailto:contact@linklyai.net" style="color: #2997ff; text-decoration: none;">contact@linklyai.net</a> 与我们取得联系。
            </div>
            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px;">
               <div style="display: flex; flex-direction: column; gap: 24px;"><div><h3 style="font-size: 12px; font-weight: 600; color: #f5f5f7; margin-bottom: 10px;">选购与了解</h3><ul style="list-style: none; padding: 0; margin: 0;"><li style="margin-bottom: 8px;"><a href="Shop_General.html" style="color: #86868b; text-decoration: none;">Linkly 商店</a></li><li style="margin-bottom: 8px;"><a href="Price_Card.html#essentials" style="color: #86868b; text-decoration: none;">Linkly 基础版</a></li><li style="margin-bottom: 8px;"><a href="Price_Card.html#studio" style="color: #86868b; text-decoration: none;">Linkly 半定制版</a></li></ul></div></div>
               <div style="display: flex; flex-direction: column; gap: 24px;"><div><h3 style="font-size: 12px; font-weight: 600; color: #f5f5f7; margin-bottom: 10px;">软件服务</h3><ul style="list-style: none; padding: 0; margin: 0;"><li style="margin-bottom: 8px;"><a href="AI_Detailed_2.html" style="color: #86868b; text-decoration: none;">Linkly AI</a></li><li style="margin-bottom: 8px;"><a href="VIP_Compare_2.html" style="color: #86868b; text-decoration: none;">会员计划</a></li></ul></div></div>
               <div style="display: flex; flex-direction: column; gap: 24px;"><div><h3 style="font-size: 12px; font-weight: 600; color: #f5f5f7; margin-bottom: 10px;">商务应用</h3><ul style="list-style: none; padding: 0; margin: 0;"><li style="margin-bottom: 8px;"><a href="B_Detailed_2black_WordPolish.html" style="color: #86868b; text-decoration: none;">Linkly 企业版</a></li></ul></div></div>
               <div style="display: flex; flex-direction: column; gap: 24px;"><div><h3 style="font-size: 12px; font-weight: 600; color: #f5f5f7; margin-bottom: 10px;">客户支持</h3><ul style="list-style: none; padding: 0; margin: 0;"><li style="margin-bottom: 8px;"><a href="Tech_Spec.html" style="color: #86868b; text-decoration: none;">技术规格参数</a></li><li style="margin-bottom: 8px;"><a href="Contact_Us.html" style="color: #86868b; text-decoration: none;">联系支持团队</a></li></ul></div></div>
               <div style="display: flex; flex-direction: column; gap: 24px;"><div><h3 style="font-size: 12px; font-weight: 600; color: #f5f5f7; margin-bottom: 10px;">关于 Linkly</h3><ul style="list-style: none; padding: 0; margin: 0;"><li style="margin-bottom: 8px;"><a href="Brand_Story.html" style="color: #86868b; text-decoration: none;">品牌故事</a></li><li style="margin-bottom: 8px;"><a href="Privacy.html" style="color: #86868b; text-decoration: none;">隐私保护</a></li></ul></div></div>
            </div>
            <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #333; display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 10px;">
                <div style="color: #86868b;">Copyright © 2025 Linkly Inc. 保留所有权利。</div>
            </div>
        </div>
    </footer>


<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- 1. 核心状态定义 ---
        const state = {
            matType: 'pvc', 
            unitPrice: 34.90, // 默认单价
            colorClass: 'bg-aurora', colorName: '极光渐变',
            patClass: 'none', patName: '纯色',
            layout: 'layout-1',
            qty: 1, 
            billing: 'yearly',
            saasTier: 'free', saasPrice: 0,
            showBranding: true,
            backLogoPos: 'pos-center',
            gift: 'ultra-6m'
        };

        const saasPricing = {
            free: { m: 0, y: 0 },
            pro: { m: 4.90, y: 49.00 },
            ultra: { m: 14.90, y: 119.00 },
            team: { m: 12.90, y: 129.00 },
            enterprise: { m: 0, y: 0 }
        };

        const pricingDatabase = {
            'pvc':       { 1: 34.90, 100: 29.90, 1000: 24.90, 10000: 19.90 },
            'pvc-matte': { 1: 34.90, 100: 29.90, 1000: 24.90, 10000: 19.90 },
            'bamboo':    { 1: 39.90, 100: 34.90, 1000: 29.90, 10000: 24.90 },
            'clear':     { 1: 44.90, 100: 39.90, 1000: 34.90, 10000: 29.90 }
        };

        // --- 2. DOM 引用 ---
        const dom = {
            // 正面
            card: document.getElementById('dynamic-card'),
            texLayer: document.getElementById('tex-layer'),
            patLayer: document.getElementById('pat-layer'),
            prevBrand: document.getElementById('prev-brand'),
            // 背面
            cardBack: document.getElementById('dynamic-card-back'),
            texLayerBack: document.getElementById('tex-layer-back'),
            patLayerBack: document.getElementById('pat-layer-back'),
            backLogo: document.getElementById('prev-back-logo'),
            // 配置区
            secColor: document.getElementById('sec-color'),
            secPat: document.getElementById('sec-pattern'),
            priceDisplay: document.getElementById('final-price'),
            topPriceDisplay: document.getElementById('unit-price-display'),
            lblMat: document.getElementById('lbl-mat'),
            lblColor: document.getElementById('lbl-color'),
            lblPat: document.getElementById('lbl-pat'),
            lblGift: document.getElementById('lbl-saas-gift'),
            qtyInput: document.getElementById('custom-qty-input'),
            // 开关
            btnBrandOn: document.getElementById('brand-on'),
            btnBrandOff: document.getElementById('brand-off')
        };

        // --- 3. 核心交互逻辑 ---

        // 材质点击
        document.getElementById('group-mat').addEventListener('click', (e) => {
            if(!e.target.classList.contains('option-btn')) return;
            setActive(e.target);
            state.matType = e.target.dataset.type;
            if(dom.lblMat) dom.lblMat.textContent = e.target.dataset.name;
            
            refreshMaterialPricing();
            handleQtyInput(state.qty);
            updateView();
            updateGiftLogic(); 
        });

        // 颜色点击
        document.getElementById('group-color').addEventListener('click', (e) => {
            if(!e.target.classList.contains('color-btn')) return;
            setActive(e.target);
            state.colorClass = e.target.dataset.color;
            state.colorName = e.target.dataset.name;
            if(dom.lblColor) dom.lblColor.textContent = state.colorName;
            updateView();
        });

        // 图案点击
        document.getElementById('group-pat').addEventListener('click', (e) => {
            if(!e.target.classList.contains('option-btn')) return;
            setActive(e.target);
            state.patClass = e.target.dataset.pat;
            state.patName = e.target.dataset.name;
            if(dom.lblPat) dom.lblPat.textContent = state.patName;
            updateView();
        });

        // 布局点击
        document.getElementById('group-layout').addEventListener('click', (e) => {
            const btn = e.target.closest('.layout-btn');
            if(!btn) return;
            document.querySelectorAll('#group-layout .layout-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            state.layout = btn.dataset.layout;
            updateView();
        });

        // 品牌开关
        window.toggleBranding = function(show) {
            state.showBranding = show;
            if(dom.btnBrandOn) dom.btnBrandOn.classList.toggle('active', show);
            if(dom.btnBrandOff) dom.btnBrandOff.classList.toggle('active', !show);
            if(dom.prevBrand) dom.prevBrand.style.display = show ? 'block' : 'none';
        }

        // 背面 Logo 位置
        const groupBackPos = document.getElementById('group-back-pos');
        if(groupBackPos) {
            groupBackPos.addEventListener('click', (e) => {
                const btn = e.target.closest('.layout-btn');
                if(!btn) return;
                document.querySelectorAll('#group-back-pos .layout-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.backLogoPos = btn.dataset.pos;
                if(dom.backLogo) dom.backLogo.className = `back-logo ${state.backLogoPos}`;
            });
        }

        // 赠送会员逻辑
        const groupGift = document.getElementById('group-saas-gift');
        if(groupGift) {
            groupGift.addEventListener('click', (e) => {
                const btn = e.target;
                if(!btn.classList.contains('option-btn') || btn.classList.contains('disabled')) return;
                document.querySelectorAll('#group-saas-gift .option-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.gift = btn.dataset.gift;
                if(dom.lblGift) dom.lblGift.textContent = btn.innerText;
            });
        }

        // 数量梯度点击
        const tierLegend = document.querySelector('.tier-legend');
        if(tierLegend) {
            tierLegend.addEventListener('click', (e) => {
                const item = e.target.closest('.tier-item');
                if(item) {
                    const minQty = parseInt(item.id.split('-')[1]);
                    handleQtyInput(minQty);
                }
            });
        }

        // --- 4. 辅助函数 ---

        window.toggleBilling = function(cycle) {
            state.billing = cycle;
            document.getElementById('btn-monthly').classList.toggle('active', cycle === 'monthly');
            document.getElementById('btn-yearly').classList.toggle('active', cycle === 'yearly');
            updateSaaSDisplay();
            updateCurrentSaasPrice();
        }

        window.selectSaas = function(tier, cardEl) {
            document.querySelectorAll('.saas-card').forEach(c => c.classList.remove('active'));
            cardEl.classList.add('active');
            state.saasTier = tier;
            updateCurrentSaasPrice();
        }

        window.adjustQty = function(delta) {
            let currentVal = dom.qtyInput ? parseInt(dom.qtyInput.value) : 1;
            handleQtyInput(currentVal + delta);
        }

        window.handleQtyInput = function(val) {
            let num = parseInt(val);
            if (isNaN(num) || num < 1) num = 1;
            if (num > 50000) num = 50000;
            
            if(dom.qtyInput) dom.qtyInput.value = num;
            state.qty = num;
            
            // 计算单价
            const table = pricingDatabase[state.matType];
            let activeTierId = 'tier-1';
            let finalPrice = table[1];

            if (num >= 10000) { finalPrice = table[10000]; activeTierId = 'tier-10000'; } 
            else if (num >= 1000) { finalPrice = table[1000]; activeTierId = 'tier-1000'; } 
            else if (num >= 100) { finalPrice = table[100]; activeTierId = 'tier-100'; }

            state.unitPrice = finalPrice;
            
            document.querySelectorAll('.tier-item').forEach(el => el.classList.remove('active'));
            const activeEl = document.getElementById(activeTierId);
            if(activeEl) activeEl.classList.add('active');
            
            updateTotalPrice();
        }

        function updateTierLogic(num) { /* 已集成在 handleQtyInput */ }

        function updateView() {
            const isSpecialMat = (state.matType === 'bamboo' || state.matType === 'clear');
            const texClass = 'layer-texture ' + (isSpecialMat ? 'show-tex ' + (state.matType === 'bamboo' ? 'tex-bamboo' : 'tex-clear') : '');
            const patClass = 'layer-pattern-overlay ' + (!isSpecialMat && state.patClass !== 'none' ? 'show-pat ' + state.patClass : '');
            
            if(dom.texLayer) dom.texLayer.className = texClass;
            if(dom.patLayer) dom.patLayer.className = patClass;
            
            if(dom.texLayerBack) dom.texLayerBack.className = texClass;
            if(dom.patLayerBack) dom.patLayerBack.className = patClass;

            if (isSpecialMat) {
                if(dom.secColor) dom.secColor.classList.add('disabled');
                if(dom.secPat) dom.secPat.classList.add('disabled');
                
                if(dom.card) dom.card.className = `interactive-card ${state.layout}`;
                if(dom.cardBack) dom.cardBack.className = `interactive-card`;
                
                if(state.matType === 'bamboo') { 
                    if(dom.card) dom.card.classList.add('text-dark'); 
                    if(dom.cardBack) dom.cardBack.classList.add('text-dark');
                } else {
                    if(dom.card) dom.card.classList.remove('text-dark');
                    if(dom.cardBack) dom.cardBack.classList.remove('text-dark');
                }
            } else {
                if(dom.secColor) dom.secColor.classList.remove('disabled');
                if(dom.secPat) dom.secPat.classList.remove('disabled');
                
                if(dom.card) dom.card.className = `interactive-card ${state.layout} ${state.colorClass}`;
                if(dom.cardBack) dom.cardBack.className = `interactive-card ${state.colorClass}`;
                
                if(['bg-mint', 'bg-yellow', 'bg-pink'].includes(state.colorClass)) { 
                    if(dom.card) dom.card.classList.add('text-dark'); 
                    if(dom.cardBack) dom.cardBack.classList.add('text-dark');
                } else {
                    if(dom.card) dom.card.classList.remove('text-dark');
                    if(dom.cardBack) dom.cardBack.classList.remove('text-dark');
                }
            }
            updateTotalPrice();
        }

        function updateGiftLogic() {
            const isPVC = (state.matType === 'pvc' || state.matType === 'pvc-matte');
            const btnPvc = document.getElementById('btn-gift-pvc');
            const btnNonPvc1 = document.getElementById('btn-gift-nonpvc-1');
            const btnNonPvc2 = document.getElementById('btn-gift-nonpvc-2');

            if(!btnPvc || !btnNonPvc1 || !btnNonPvc2) return;

            [btnPvc, btnNonPvc1, btnNonPvc2].forEach(b => {
                b.classList.remove('active');
                b.classList.add('disabled');
            });

            if (isPVC) {
                btnPvc.classList.remove('disabled');
                btnPvc.classList.add('active');
                state.gift = 'ultra-6m';
                if(dom.lblGift) dom.lblGift.textContent = "Ultra AI 6个月";
            } else {
                btnNonPvc1.classList.remove('disabled');
                btnNonPvc2.classList.remove('disabled');
                btnNonPvc1.classList.add('active');
                state.gift = 'ultra-1y';
                if(dom.lblGift) dom.lblGift.textContent = "Ultra AI 1年";
            }
        }

        function refreshMaterialPricing() {
            const table = pricingDatabase[state.matType];
            if(!table) return;
            const p1 = document.getElementById('p-tier-1');
            const p100 = document.getElementById('p-tier-100');
            const p1000 = document.getElementById('p-tier-1000');
            const p10000 = document.getElementById('p-tier-10000');

            if(p1) p1.textContent = `$${table[1].toFixed(2)}`;
            if(p100) p100.textContent = `$${table[100].toFixed(2)}`;
            if(p1000) p1000.textContent = `$${table[1000].toFixed(2)}`;
            if(p10000) p10000.textContent = `$${table[10000].toFixed(2)}`;
        }

        function updateSaaSDisplay() {
            const isYear = state.billing === 'yearly';
            const ids = ['price-pro', 'save-pro', 'price-ultra', 'save-ultra', 'price-team', 'save-team'];
            if(document.getElementById(ids[0])) {
                document.getElementById('price-pro').textContent = isYear ? '$49.00/年' : '$4.90/月';
                document.getElementById('save-pro').style.display = isYear ? 'block' : 'none';
                document.getElementById('price-ultra').textContent = isYear ? '$119.00/年' : '$14.90/月';
                document.getElementById('save-ultra').style.display = isYear ? 'block' : 'none';
                document.getElementById('price-team').textContent = isYear ? '$129.00/人/年' : '$12.90/人/月';
                document.getElementById('save-team').style.display = isYear ? 'block' : 'none';
            }
        }

        function updateCurrentSaasPrice() {
            const cycleKey = state.billing === 'yearly' ? 'y' : 'm';
            state.saasPrice = saasPricing[state.saasTier][cycleKey];
            updateTotalPrice();
        }

        function updateTotalPrice() {
            if (!state.unitPrice || isNaN(state.unitPrice)) state.unitPrice = 34.90;
            const total = (state.unitPrice * state.qty) + state.saasPrice;
            if(dom.topPriceDisplay) dom.topPriceDisplay.textContent = `$${state.unitPrice.toFixed(2)}`;
            if(dom.priceDisplay) dom.priceDisplay.textContent = `$${total.toFixed(2)}`;
        }

        function setActive(target) {
            Array.from(target.parentElement.children).forEach(c => c.classList.remove('active'));
            target.classList.add('active');
        }

        window.updateTxt = function(id, val) {
            const el = document.getElementById(id);
            if(el) el.textContent = val;
        }

        window.selectTier = function(minQty) { handleQtyInput(minQty); }

        window.handleUpload = function(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const avatar = document.getElementById('prev-avatar');
                    if(avatar) {
                        avatar.style.backgroundImage = `url(${e.target.result})`;
                        avatar.classList.add('has-img');
                    }
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        window.handleLogoUpload = function(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    if(dom.backLogo) {
                        dom.backLogo.src = e.target.result;
                        dom.backLogo.style.opacity = '1';
                    }
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // --- 5. 核心：构建商品数据 ---
        function createCurrentItem() {
            const inputs = document.querySelectorAll('.input-field');
            // Happy 版输入框顺序: 0:昵称, 1:身份, 2:MBTI, 3:社交ID, 4:自定义
            const cName = inputs[0] ? inputs[0].value : '';
            const cTag = inputs[1] ? inputs[1].value : '';
            const cMbti = inputs[2] ? inputs[2].value : '';
            const cSocial = inputs[3] ? inputs[3].value : '';
            const cCustom = inputs[4] ? inputs[4].value : '';

            let saasList = [];
            // 1. 付费 SaaS
            if (state.saasTier !== 'free') {
                const activeSaas = document.querySelector('.saas-card.active');
                let rawTitle = state.saasTier;
                if(activeSaas) {
                    rawTitle = activeSaas.querySelector('.saas-name').childNodes[0].textContent.trim();
                }
                const cycle = (state.billing === 'yearly') ? '(年付)' : '(月付)';
                saasList.push({ name: state.saasTier, display: rawTitle + " " + cycle, price: state.saasPrice, type: 'paid' });
            }
            // 2. 赠送 SaaS
            const activeGift = document.querySelector('#group-saas-gift .option-btn.active');
            if (activeGift && !activeGift.classList.contains('disabled')) {
                saasList.push({ name: activeGift.dataset.gift, display: "赠送: " + activeGift.innerText, price: 0, type: 'gift' });
            }

            return {
                id: 'hap_' + Date.now(),
                timestamp: Date.now(),
                sourcePage: 'Studio_Happy',
                productName: 'Linkly Studio 半定制休闲版',
                qty: state.qty,

                config: {
                    material: state.matType,
                    materialName: dom.lblMat ? dom.lblMat.innerText : state.matType,
                    color: state.colorClass,
                    colorName: state.colorName,
                    pattern: state.patClass,
                    patternName: state.patName,
                    branding: state.showBranding,
                    backLogoPosition: state.backLogoPos
                },

                // 映射到 Checkout 通用结构
                custom: {
                    name: cName,
                    title: cTag,     // 映射为身份
                    company: cSocial, // 映射为公司/ID (这里放社交ID)
                    extra: `MBTI: ${cMbti} / ${cCustom}` // 额外信息
                },

                saasList: saasList,
                saas: saasList.length > 0 ? saasList[0] : { name: 'free', display: 'Free', price: 0 }
            };
        }

        // --- 6. 按钮事件 ---

        // 添加到购物袋
        const btnAddBag = document.getElementById('btn-add-bag') || document.querySelector('.btn-secondary');
        if(btnAddBag) {
            btnAddBag.addEventListener('click', function() {
                const newItem = createCurrentItem();
                let cart = [];
                try {
                    cart = JSON.parse(localStorage.getItem('linkly_cart') || '[]');
                } catch(e) { cart = []; }
                
                cart.push(newItem);
                localStorage.setItem('linkly_cart', JSON.stringify(cart));
                
                const originalText = this.innerText;
                this.innerText = '已加入购物袋 ✔';
                this.style.background = '#0071e3';
                this.style.color = '#fff';
                setTimeout(() => {
                    this.innerText = originalText;
                    this.style.background = '';
                    this.style.color = '';
                }, 2000);
            });
        }

        // 立即结账
        const btnBuyNow = document.getElementById('btn-buy-now') || document.querySelector('.btn-primary');
        if(btnBuyNow) {
            btnBuyNow.addEventListener('click', function() {
                const newItem = createCurrentItem();
                
                // 计算单次结账总价
                let hardwareTotal = state.unitPrice * state.qty;
                if (hardwareTotal < 0) hardwareTotal = 0;
                let saasTotal = 0;
                newItem.saasList.forEach(s => saasTotal += s.price);
                
                const checkoutData = {
                    items: [newItem],
                    total: hardwareTotal + saasTotal,
                    timestamp: Date.now()
                };

                localStorage.setItem('linkly_checkout_pending', JSON.stringify(checkoutData));
                window.location.href = 'Checkout.html';
            });
        }

        // 初始化执行
        setTimeout(() => {
            refreshMaterialPricing();
            handleQtyInput(1);
            updateView();
            updateSaaSDisplay();
            updateGiftLogic();
        }, 50);
    });
</script>

</body>
</html>